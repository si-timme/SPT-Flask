{% extends "base.html" %}
{% block content %}

<h2>Process Chain</h2>

<div class="toolbar" style="margin-bottom:10px;">
  <!-- Input expression field -->
  <label>Input x(t):</label>
  <input type="text" id="inputExpression" value="sin(t)" size="15">
  
  <!-- Buttons to add blocks -->
  <button onclick="addBlock('Addition','+')">Add Addition</button>
  <button onclick="addBlock('Subtraction','-')">Add Subtraction</button>
  <button onclick="addBlock('Multiplication','×')">Add Multiplication</button>
  <button onclick="addBlock('Filter','Filter')">Add Filter</button>
  <button onclick="addBlock('Hilbert','Hilbert')">Add Hilbert</button>
  <button onclick="addBlock('Derivative','d/dt')">Add d/dt</button>
  
  <!-- Add Dot or Misc. -->
  <button onclick="addDot()">Add Dot</button>
  <button onclick="toggleConnectMode()">Connect</button>
  
  <!-- Deletion / Clear -->
  <button onclick="deleteSelected()">Delete</button>
  <button onclick="clearAll()">Clear</button>
  
  <!-- (Optionally) a 'Compute' or 'Plot' button that triggers an AJAX to the server -->
  <button onclick="computeChain()">Compute</button>
</div>

<!-- Canvas for the chain UI -->
<canvas id="chainCanvas" width="900" height="500"
  style="border:1px solid #ccc;">
  Your browser does not support Canvas.
</canvas>

<!-- A place to show the final plot (if you do an AJAX approach) -->
<div id="plotResult" style="margin-top:20px;">
  <!-- an <img> for base64 or perhaps some text if we show a symbolic expression -->
</div>

<!-- A hidden modal or overlay for editing block parameters -->
<div id="blockModal" style="display:none; position:fixed; top:50%; left:50%;
     transform:translate(-50%,-50%); width:300px; background:#fff; padding:10px;
     border:2px solid #666; z-index:999;">
  <h3>Edit Block</h3>
  <p id="blockTypeLabel"></p>
  <label>Parameter:</label>
  <input type="text" id="blockParamInput" style="width:80%;">
  
  <div style="margin-top:10px;">
    <button onclick="saveBlockParam()">Save</button>
    <button onclick="closeBlockModal()">Cancel</button>
  </div>
  
  <!-- Possibly add quick function inserts, e.g. "sin(ω₀t)" "LP Filter" etc. -->
</div>
<!-- Filter Modal -->
<div id="filterModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:400px; background:#fff; padding:20px; border:2px solid #666; z-index:999;">
  <h3>Configure Filter Block</h3>
  <label for="filterType">Filter Type:</label>
  <select id="filterType">
    <option value="lowpass">Lowpass</option>
    <option value="highpass">Highpass</option>
    <option value="bandpass">Bandpass</option>
  </select>
  <div id="filterParams">
    <div id="singleCutoff">
      <label for="cutoffValue">Cutoff Frequency (w):</label>
      <input type="number" id="cutoffValue" step="0.1" value="1.0" />
    </div>
    <div id="bandCutoffs" style="display:none;">
      <label for="lowCutoff">Low Cutoff (w):</label>
      <input type="number" id="lowCutoff" step="0.1" value="0.5" />
      <br>
      <label for="highCutoff">High Cutoff (w):</label>
      <input type="number" id="highCutoff" step="0.1" value="2.0" />
    </div>
  </div>
  <div style="margin-top:10px;">
    <button id="filterModalOk">OK</button>
    <button id="filterModalCancel">Cancel</button>
  </div>
</div>
<!-- Multiplication Block Modal -->
<div id="multiplicationModal"
     style="display:none; position:fixed; top:50%; left:50%;
            transform:translate(-50%,-50%); width:400px;
            background:#fff; padding:20px; border:2px solid #666; z-index:999;">

  <h3>Configure Multiplication Block</h3>

  <label for="multType">Multiplication Type:</label>
  <select id="multType">
    <option value="constant">Constant (K)</option>
    <option value="imaginary">Imaginary unit (j)</option>
    <option value="linear">Linear (A·ω)</option>
    <option value="sin">sin(ω) [A, ω₀]</option>
    <option value="cos">cos(ω) [A, ω₀]</option>
    <option value="exponential">exp(±j ω₀ t)</option>
    <option value="sampling">Sampling (interval T)</option>
  </select>

  <!-- live format hint -->
  <p id="multHint"
     style="font-size:0.9em; color:#555; margin:6px 0 0 0;">
     Format: K → <code>4</code>
  </p>

  <!-- generic parameter input -->
  <div id="multParamDiv" style="margin-top:10px; display:block;">
    <label for="multParamValue">Parameter:</label>
    <input type="text" id="multParamValue" placeholder="e.g. 4 or 3,1.5" />
  </div>

  <!-- sampling‑specific input -->
  <div id="samplingDiv" style="margin-top:10px; display:none;">
    <label for="samplingInterval">Sampling interval T:</label>
    <input type="number" id="samplingInterval" step="0.1" value="1.0" />
  </div>

  <div style="margin-top:14px; text-align:right;">
    <button id="multModalOk">OK</button>
    <button id="multModalCancel">Cancel</button>
  </div>
</div>

  <!-- Parameter input for types that require a numeric value or coefficient -->
  <div id="multParamDiv" style="margin-top:10px; display:none;">
    <label for="multParamValue">Parameter:</label>
    <input type="text" id="multParamValue" placeholder="Enter parameter value" />
  </div>
  
  <!-- Sampling-specific input -->
  <div id="samplingDiv" style="margin-top:10px; display:none;">
    <label for="samplingInterval">Sampling Interval (w):</label>
    <input type="number" id="samplingInterval" step="0.1" value="1.0" />
  </div>
  
  <div style="margin-top:10px;">
    <button id="multModalOk">OK</button>
    <button id="multModalCancel">Cancel</button>
  </div>
</div>


<script src="{{ url_for('static', filename='js/process_chain.js') }}"></script>
{% endblock %}
